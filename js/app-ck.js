(function(){var e=function(e){var n=document.getElementById("screen"),r=n.getContext("2d"),s={x:n.width,y:n.height};this.bodies=i(this).concat(new t(this,s));var o=this;a("Gun.wav",function(e){o.shootSound=e;var t=function(){o.update();o.draw(r,s);requestAnimationFrame(t)};t()})};e.prototype={update:function(){var e=this.bodies,t=function(t){return e.filter(function(e){return u(t,e)}).length===0};this.bodies=this.bodies.filter(t);for(var n=0;n<this.bodies.length;n++)this.bodies[n].update()},draw:function(e,t){e.clearRect(0,0,t.x,t.y);for(var n=0;n<this.bodies.length;n++)s(e,this.bodies[n])},addBody:function(e){this.bodies.push(e)},invadersBelow:function(e){return this.bodies.filter(function(t){return t instanceof r&&t.center.y>e.center.y&&t.center.x-e.center.x<e.size.x}).length>0}};var t=function(e,t){this.game=e;this.size={x:15,y:15};this.center={x:t.x/2,y:t.y-this.size.x};this.keyboarder=new o};t.prototype={update:function(){this.keyboarder.isDown(this.keyboarder.KEYS.LEFT)?this.center.x-=2:this.keyboarder.isDown(this.keyboarder.KEYS.RIGHT)&&(this.center.x+=2);if(this.keyboarder.isDown(this.keyboarder.KEYS.SPACE)){var e=new n({x:this.center.x,y:this.center.y-this.size.x/2},{x:0,y:-6});this.game.addBody(e);this.game.shootSound.load();this.game.shootSound.play()}}};var n=function(e,t){this.size={x:3,y:3};this.center=e;this.velocity=t};n.prototype={update:function(){this.center.x+=this.velocity.x;this.center.y+=this.velocity.y}};var r=function(e,t){this.game=e;this.size={x:15,y:15};this.center=t;this.patrolX=0;this.speedX=.5};r.prototype={update:function(){if(this.patrolX<0||this.patrolX>100)this.speedX=-this.speedX;this.center.x+=this.speedX;this.patrolX+=this.speedX;if(Math.random()>.995&&!this.game.invadersBelow(this)){var e=new n({x:this.center.x,y:this.center.y+this.size.x/2},{x:Math.random()-.5,y:2});this.game.addBody(e)}}};var i=function(e){var t=[];for(var n=0;n<24;n++){var i=30+n%8*30+n%8*30,s=30+n%3*30+n%3*30;t.push(new r(e,{x:i,y:s}))}return t},s=function(e,t){e.fillRect(t.center.x-t.center.x/2,t.center.y-t.center.y/2,t.size.x,t.size.y)},o=function(){var e={};window.onkeydown=function(t){e[t.keyCode]=!0};window.onkeyup=function(t){e[t.keyCode]=!1};this.isDown=function(t){return e[t]===!0};this.KEYS={LEFT:37,RIGHT:39,SPACE:32}},u=function(e,t){return!(e===t||e.center.x+e.size.x/2<t.center.x-t.size.x/2||e.center.y+e.size.y/2<t.center.y-t.size.y/2||e.center.x-e.size.x/2>t.center.x+t.size.x/2||e.center.y-e.size.y/2>t.center.y+t.size.y/2)},a=function(e,t){var n=function(){t(r);r.removeEventListener("canplaythrough",n)},r=new Audio(e);r.addEventListener("canplaythrough",n);r.load()};window.onload=function(){new e("screen")}})();